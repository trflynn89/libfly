parameters:
  name: 'Windows_Debug'
  arch: 'x64'

jobs:
  - job: ${{ parameters.name }}
    pool:
      vmImage: 'vs2017-win2016'

    steps:
    - script: |
        git submodule update --init --recursive
      displayName: 'Setup'

    - task: MSBuild@1
      inputs:
        solution: 'build\win\libfly.sln'
        maximumCpuCount: true
        configuration: 'Debug'
        platform: '${{ parameters.arch }}'
      displayName: 'Build'

    - task: PowerShell@2
      inputs:
        filePath: build\win\test.ps1
        arguments: -arch ${{ parameters.arch }}
      displayName: 'Test'
