parameters:
  build_path: ''
  gcov: 'gcov'

steps:
  - script: |
      lcov --gcov-tool ${{ parameters.gcov }} --capture \
        --directory ${{ parameters.build_path}} --output-file coverage.info
      lcov --remove coverage.info '/usr/*' '*/test/*' --output-file coverage.info
      lcov --list coverage.info

      bash <(curl -s https://codecov.io/bash) -f coverage.info
    displayName: 'Coverage'
