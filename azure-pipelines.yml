pool:
  vmImage: 'Ubuntu-16.04'

strategy:
  matrix:
    ubuntu18:
      containerImage: ubuntu:18.04

container: $[ variables['containerImage'] ]

steps:
- script: |
    nproc
    lsb_release -a
    sudo apt-get install -y gcc-multilib g++-multilib
    git submodule update --init --recursive
  displayName: 'setup'

- script: ./build/nix/release.sh
  displayName: 'build'

- task: CopyFiles@2
  inputs:
    Contents: 'build/nix/release-*/etc/libfly-*.tar.bz2'
    TargetFolder: $(Build.ArtifactStagingDirectory)
    flattenFolders: true

- task: PublishBuildArtifacts@1
  inputs:
    PathtoPublish: $(Build.ArtifactStagingDirectory)
    ArtifactName: artifacts
